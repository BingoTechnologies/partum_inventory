{% extends 'base.html' %}
{% block submenu_add_product %}active{% endblock %}
{% block menu_product %}active{% endblock %}
{% block content %}
    <div class="col-md-6">
        <br>
        <a href="{% url 'product:items_list' %}"><button type="button" class="btn btn-primary" style="float: left">Back to Product List</button></a>
        <br><br><br>
        <div class="content-panel">
            <h3 class="text-center">{{ request.user.retailer_user.retailer.name }} Product</h3>
             <span class="item_list_error text-center" style="color:red; display:none">item is already exist</span>
            <div class="panel-body">
                <form class="form-horizontal add-product-form" action="{% url 'product:add_product' retailer_id=request.user.retailer_user.retailer.id %}" method="post" >
                    <div class="form-group">
                        <div class="col-sm-12">
                            {% csrf_token %}
                            <span class="product-name-error" style="color:red; display:none">The field is required</span>
                            <input type="text" class="form-control product_name" name="name"   placeholder="Product Name"><br>
                            <span class="brand-name-error" style="color:red; display:none">The field is required</span>
                            <input type="text" class="form-control brand_name" name="brand_name" placeholder="Brand Name"><br>
                            <span class="retail-name-error" style="color:red; display:none">The field is required</span>
                            <input type="text" class="form-control retail_price" name="retail_price" placeholder="Retail Price"><br>
                            <span class="consumer-name-error" style="color:red; display:none">The field is required</span>
                            <input type="text" class="form-control consumer_price" name="consumer_price"  placeholder="Consumer Price"><br>
                            <span class="available-name-error" style="color:red; display:none">The field is required</span>
                            <input type="text"  class="form-control available_item" name="available_item"   placeholder="Item Quantity"><br>
                            <input type="hidden" name="retailer" value="{{ request.user.retailer_user.retailer.id }}">
                            <button type="button" class="btn btn-primary product-submit-btn" style="float: right">Save Product</button>

                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!--scrpit for field validation-->

<script>

    $ (document).ready(function(){
        $ (".product-submit-btn").on('click', function(){
            var error = false;

            if ($('.product_name').val() == ""){
                $(".product-name-error").show();
                error = true;
            }
            else {
                $(".product-name-error").hide();
            }

            if ($('.brand_name').val() == ""){
                $(".brand-name-error").show();
                error = true;
            }
            else {
                $(".brand-name-error").hide();

            }

            if ($('.retail_price').val() == ""){
                $(".retail-name-error").show();
                error = true;
            }
            else {
                $(".retail-name-error").hide();
            }

            if ($('.consumer_price').val() == ""){
                $(".consumer-name-error").show();
                error = true;
            }
            else {
                $(".consumer-name-error").hide();
            }
            if ($('.available_item').val() == ""){
                $(".available-name-error").show();
                error = true;
            }
            else {
                $(".available-name-error").hide();

            }

            if (error == true) {
                return;
            } else {
                // Call API Here
                $.get('{% url 'retailer:retailer_products' retailer_id=request.user.retailer_user.retailer.id %}', function(data, status){
                    $.each(data.retailer_products, function(index, value){
                        if ($('.product_name').val() == value.product_name && $('.brand_name').val() == value.brand_name && {{ request.user.retailer_user.retailer.id }} == value.retailer){
                            $('.item_list_error').show();
                            error = true;
                            return false;
                        }
                    });
                    if (error == false) {
                        $('.add-product-form').submit();
                    }
                });

            }
        });

        $('.product_name').keyup(function(){
            $('.product-name-error').hide();
        });

        $('.brand_name').keyup(function(){
            $('.brand-name-error').hide();
        });

        $('.retail_price').keyup(function(){
            $('.retail-name-error').hide();
            checkDec(this);
        });
        function checkDec(el){
            var ex = /^[0-9]+\.?[0-9]*$/;
            if(ex.test(el.value)==false){
                el.value = el.value.substring(0,el.value.length - 1);
            }
        }

        $('.consumer_price').keyup(function(){
            $('.consumer-name-error').hide()
            checkDec(this);
        });
        function checkDec(el){
            var ex = /^[0-9]+\.?[0-9]*$/;
            if(ex.test(el.value)==false){
                el.value = el.value.substring(0,el.value.length - 1);
            }
        }

        $('.available_item').keyup(function(){
            $('.available-name-error').hide()
            checkDec(this);
        });
        function checkDec(el){
            var ex = /^[0-9]+\.?[0-9]*$/;
            if(ex.test(el.value)==false){
                el.value = el.value.substring(0,el.value.length - 1);
            }
        }

    });
</script>

{% endblock %}
